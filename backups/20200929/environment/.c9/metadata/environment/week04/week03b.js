{"filter":false,"title":"week03b.js","tooltip":"/week04/week03b.js","undoManager":{"mark":2,"position":2,"stack":[[{"start":{"row":0,"column":0},"end":{"row":156,"column":3},"action":"remove","lines":["////////////////////","//WEEK 04","////////////////////","","// \"use strict\"","","// // DEPENDENCIES","// const fs = require('fs'),","//       cheerio = require('cheerio'),","//       querystring = require('querystring'),","//       request = require('request'),","//       async = require('async'),","//       dotenv = require('dotenv');","","// // // LOAD aa/03.txt INTO A VARIABLE","// let content = fs.readFileSync('data/aa/03.txt');","","// // // PARSE VARIABLE 'CONTENT' INTO A CHEERIO OBJECT","// let $ = cheerio.load(content);","","// // // SCRAPE GENERAL LOCATION DATA","// let locations = [];","","// // REMOVE EMPTY EXCESS HTML","// $('.detailsBox').empty(); //removing details","// $('h4').empty(); //removing locations","// $('b').empty(); //removing meeting names","// $('img').empty(); //removing images + wheelchair text","// $('a').empty(); //removing meeting names","// $('span').empty(); //removing random spans","","// // USE REGEX TO REPLACE TABS/NOBREAK SPACES/RETURNS, ANYTHING IN PARENTHESIS","// $('td[style*=\"border-bottom:1px solid #e3e3e3; width:260px\"]').each(function(i, elem) {","//   locations.push($(elem).text().replace(/(\\t|\\n|\\r)/gm, \"\").replace(/\\s*\\(.*?\\)\\s*/g, '').trim());","//     // console.log(locations)","","// // USE SPLIT TO PULL JUST ADDRESSES","// // let locData = locations.split(\",\");","// // let addresses = []","// // $(locations).split(\",\").pop().each(function(i, elem) { ","// //   addresses.push($(elem.text().trim()))","// //   console.log(addresses)","// //   });","  ","// // });","","// // TAMU API KEY","// dotenv.config();","// const API_KEY = process.env.API_KEY;","// const API_URL = 'https://geoservices.tamu.edu/Services/Geocode/WebService/GeocoderWebServiceHttpNonParsed_V04_01.aspx'","","// // ADDRESSES","// let meetingsData = [];","// let addresses = ['7 East 10th Street, 2nd Floor, 10003','155 East 22nd Street,NY 10010','61 Fourth Avenue, 3rd Floor, 9th & 10th St 10003,'];","// // console.log(addresses)","","// // eachSeries in the async module iterates over an array and operates on each item in the array in series","// // async.eachSeries(locations, function(value, callback) { //LOCATIONS MADE ME RUN OUT OF CREDITS (I thought there would only be 74 calls!)","// async.eachSeries(addresses, function(value, callback) {","//     let query = {","//         streetAddress: value,","//         city: \"New York\",","//         state: \"NY\",","//         apikey: API_KEY,","//         format: \"json\",","//         version: \"4.01\"","//     };","","//     // construct a querystring from the `query` object's values and append it to the api URL","//     let apiRequest = API_URL + '?' + querystring.stringify(query);","","//     request(apiRequest, function(err, resp, body) {","//         if (err){ throw err; }","","//         let tamuGeo = JSON.parse(body);","//         console.log(tamuGeo['FeatureMatchingResultType'], apiRequest);","//         meetingsData.push(tamuGeo);","//     });","","//     // sleep for a couple seconds before making the next request","//     setTimeout(callback, 2000);","// }, function() {","//     fs.writeFileSync('data/aa-json/addressTest.json', JSON.stringify(meetingsData));","//     console.log('*** *** *** *** ***');","//     console.log(`Number of meetings in this zone: ${meetingsData.length}`);","//   });","  ","// });","","// MAKE JSON PRETTY","// npm install esformatter","","// MODULES REQUIRED","const {Client} = require('pg'),","      dotenv = require('dotenv'),","      async = require('async');","","// AWS RDS POSTGRESQL INSTANCE","dotenv.config(); ","let db_credentials = {","    host: 'data-structures.cip6jcccwdtt.us-east-2.rds.amazonaws.com', // ENDPOINT FROM RDW AWS CONSOLE","    database: 'aa',","    user: 'ds2020',","    password: process.env.AWSRDS_PW,","    port: 5432,","}","","// CONNECT TO AWS RDS POSTGRES DB","const client = new Client(db_credentials);","client.connect();","","// CREATE TABLE WITH LISTED COLUMNS:","// let query = `CREATE TABLE aalocations (","//   address varchar(150),","//   lat double precision,","//   long double precision","// );`;","","// DROP TABLE IS DANGEROUS BUT CHANGING COLUMN VALUES IS HARD","// let query = \"DROP TABLE aalocations;\";","","// client.query(query, (err, res) => {","//     if (err){ throw err; }","","//     console.log(res);","//     client.end();","// });","","// ADDRESSES LISTED IN AN OBJECT WITH LAT LON","","let addressesForDb = [","  {address: '63 Fifth Ave, New York, NY', latLong: {lat: 40.7353041, lng: -73.99413539999999} },","  {address: '16 E 16th St, New York, NY', latLong: {lat: 40.736765,  lng: -73.9919024} },","  {address: '2 W 13th St, New York, NY',  latLong: {lat: 40.7353297, lng: -73.99447889999999} }","];","","","// ASYNC MODULE LOOPS THROUGH DATA TO PUT INTO TABLE","","async.eachSeries(addressesForDb, function(value, callback) {","    let client = new Client(db_credentials); // CONNECT TO DB","    client.connect();","","    // VARIABLES BECOME VALUES IN AN ARRAY","    let query = {","      text: \"INSERT INTO aalocations VALUES($1, $2, $3)\",","      values: [value.address, value.latLong.lat, value.latLong.lng]","    };","","    client.query(query, (err, res) => {","        if (err){ throw err; }","","        console.log(res);","        client.end();","    });","    setTimeout(callback, 1000);","});"],"id":2},{"start":{"row":0,"column":0},"end":{"row":87,"column":26},"action":"insert","lines":["","// \"use strict\"","","// // DEPENDENCIES","// const fs = require('fs'),","//       cheerio = require('cheerio'),","//       querystring = require('querystring'),","//       request = require('request'),","//       async = require('async'),","//       dotenv = require('dotenv');","","// // // LOAD aa/03.txt INTO A VARIABLE","// let content = fs.readFileSync('data/aa/03.txt');","","// // // PARSE VARIABLE 'CONTENT' INTO A CHEERIO OBJECT","// let $ = cheerio.load(content);","","// // // SCRAPE GENERAL LOCATION DATA","// let locations = [];","","// // REMOVE EMPTY EXCESS HTML","// $('.detailsBox').empty(); //removing details","// $('h4').empty(); //removing locations","// $('b').empty(); //removing meeting names","// $('img').empty(); //removing images + wheelchair text","// $('a').empty(); //removing meeting names","// $('span').empty(); //removing random spans","","// // USE REGEX TO REPLACE TABS/NOBREAK SPACES/RETURNS, ANYTHING IN PARENTHESIS","// $('td[style*=\"border-bottom:1px solid #e3e3e3; width:260px\"]').each(function(i, elem) {","//   locations.push($(elem).text().replace(/(\\t|\\n|\\r)/gm, \"\").replace(/\\s*\\(.*?\\)\\s*/g, '').trim());","//     // console.log(locations)","","// // USE SPLIT TO PULL JUST ADDRESSES","// // let locData = locations.split(\",\");","// // let addresses = []","// // $(locations).split(\",\").pop().each(function(i, elem) { ","// //   addresses.push($(elem.text().trim()))","// //   console.log(addresses)","// //   });","  ","// // });","","// // TAMU API KEY","// dotenv.config();","// const API_KEY = process.env.API_KEY;","// const API_URL = 'https://geoservices.tamu.edu/Services/Geocode/WebService/GeocoderWebServiceHttpNonParsed_V04_01.aspx'","","// // ADDRESSES","// let meetingsData = [];","// let addresses = ['7 East 10th Street, 2nd Floor, 10003','155 East 22nd Street,NY 10010','61 Fourth Avenue, 3rd Floor, 9th & 10th St 10003,'];","// // console.log(addresses)","","// // eachSeries in the async module iterates over an array and operates on each item in the array in series","// // async.eachSeries(locations, function(value, callback) { //LOCATIONS MADE ME RUN OUT OF CREDITS (I thought there would only be 74 calls!)","// async.eachSeries(addresses, function(value, callback) {","//     let query = {","//         streetAddress: value,","//         city: \"New York\",","//         state: \"NY\",","//         apikey: API_KEY,","//         format: \"json\",","//         version: \"4.01\"","//     };","","//     // construct a querystring from the `query` object's values and append it to the api URL","//     let apiRequest = API_URL + '?' + querystring.stringify(query);","","//     request(apiRequest, function(err, resp, body) {","//         if (err){ throw err; }","","//         let tamuGeo = JSON.parse(body);","//         console.log(tamuGeo['FeatureMatchingResultType'], apiRequest);","//         meetingsData.push(tamuGeo);","//     });","","//     // sleep for a couple seconds before making the next request","//     setTimeout(callback, 2000);","// }, function() {","//     fs.writeFileSync('data/aa-json/addressTest.json', JSON.stringify(meetingsData));","//     console.log('*** *** *** *** ***');","//     console.log(`Number of meetings in this zone: ${meetingsData.length}`);","//   });","  ","// });","","// MAKE JSON PRETTY","// npm install esformatter"]}],[{"start":{"row":1,"column":0},"end":{"row":1,"column":3},"action":"remove","lines":["// "],"id":3},{"start":{"row":3,"column":0},"end":{"row":3,"column":3},"action":"remove","lines":["// "]},{"start":{"row":4,"column":0},"end":{"row":4,"column":3},"action":"remove","lines":["// "]},{"start":{"row":5,"column":0},"end":{"row":5,"column":3},"action":"remove","lines":["// "]},{"start":{"row":6,"column":0},"end":{"row":6,"column":3},"action":"remove","lines":["// "]},{"start":{"row":7,"column":0},"end":{"row":7,"column":3},"action":"remove","lines":["// "]},{"start":{"row":8,"column":0},"end":{"row":8,"column":3},"action":"remove","lines":["// "]},{"start":{"row":9,"column":0},"end":{"row":9,"column":3},"action":"remove","lines":["// "]},{"start":{"row":11,"column":0},"end":{"row":11,"column":3},"action":"remove","lines":["// "]},{"start":{"row":12,"column":0},"end":{"row":12,"column":3},"action":"remove","lines":["// "]},{"start":{"row":14,"column":0},"end":{"row":14,"column":3},"action":"remove","lines":["// "]},{"start":{"row":15,"column":0},"end":{"row":15,"column":3},"action":"remove","lines":["// "]},{"start":{"row":17,"column":0},"end":{"row":17,"column":3},"action":"remove","lines":["// "]},{"start":{"row":18,"column":0},"end":{"row":18,"column":3},"action":"remove","lines":["// "]},{"start":{"row":20,"column":0},"end":{"row":20,"column":3},"action":"remove","lines":["// "]},{"start":{"row":21,"column":0},"end":{"row":21,"column":3},"action":"remove","lines":["// "]},{"start":{"row":22,"column":0},"end":{"row":22,"column":3},"action":"remove","lines":["// "]},{"start":{"row":23,"column":0},"end":{"row":23,"column":3},"action":"remove","lines":["// "]},{"start":{"row":24,"column":0},"end":{"row":24,"column":3},"action":"remove","lines":["// "]},{"start":{"row":25,"column":0},"end":{"row":25,"column":3},"action":"remove","lines":["// "]},{"start":{"row":26,"column":0},"end":{"row":26,"column":3},"action":"remove","lines":["// "]},{"start":{"row":28,"column":0},"end":{"row":28,"column":3},"action":"remove","lines":["// "]},{"start":{"row":29,"column":0},"end":{"row":29,"column":3},"action":"remove","lines":["// "]},{"start":{"row":30,"column":0},"end":{"row":30,"column":3},"action":"remove","lines":["// "]},{"start":{"row":31,"column":0},"end":{"row":31,"column":3},"action":"remove","lines":["// "]},{"start":{"row":33,"column":0},"end":{"row":33,"column":3},"action":"remove","lines":["// "]},{"start":{"row":34,"column":0},"end":{"row":34,"column":3},"action":"remove","lines":["// "]},{"start":{"row":35,"column":0},"end":{"row":35,"column":3},"action":"remove","lines":["// "]},{"start":{"row":36,"column":0},"end":{"row":36,"column":3},"action":"remove","lines":["// "]},{"start":{"row":37,"column":0},"end":{"row":37,"column":3},"action":"remove","lines":["// "]},{"start":{"row":38,"column":0},"end":{"row":38,"column":3},"action":"remove","lines":["// "]},{"start":{"row":39,"column":0},"end":{"row":39,"column":3},"action":"remove","lines":["// "]},{"start":{"row":41,"column":0},"end":{"row":41,"column":3},"action":"remove","lines":["// "]},{"start":{"row":43,"column":0},"end":{"row":43,"column":3},"action":"remove","lines":["// "]},{"start":{"row":44,"column":0},"end":{"row":44,"column":3},"action":"remove","lines":["// "]},{"start":{"row":45,"column":0},"end":{"row":45,"column":3},"action":"remove","lines":["// "]},{"start":{"row":46,"column":0},"end":{"row":46,"column":3},"action":"remove","lines":["// "]},{"start":{"row":48,"column":0},"end":{"row":48,"column":3},"action":"remove","lines":["// "]},{"start":{"row":49,"column":0},"end":{"row":49,"column":3},"action":"remove","lines":["// "]},{"start":{"row":50,"column":0},"end":{"row":50,"column":3},"action":"remove","lines":["// "]},{"start":{"row":51,"column":0},"end":{"row":51,"column":3},"action":"remove","lines":["// "]},{"start":{"row":53,"column":0},"end":{"row":53,"column":3},"action":"remove","lines":["// "]},{"start":{"row":54,"column":0},"end":{"row":54,"column":3},"action":"remove","lines":["// "]},{"start":{"row":55,"column":0},"end":{"row":55,"column":3},"action":"remove","lines":["// "]},{"start":{"row":56,"column":0},"end":{"row":56,"column":3},"action":"remove","lines":["// "]},{"start":{"row":57,"column":0},"end":{"row":57,"column":3},"action":"remove","lines":["// "]},{"start":{"row":58,"column":0},"end":{"row":58,"column":3},"action":"remove","lines":["// "]},{"start":{"row":59,"column":0},"end":{"row":59,"column":3},"action":"remove","lines":["// "]},{"start":{"row":60,"column":0},"end":{"row":60,"column":3},"action":"remove","lines":["// "]},{"start":{"row":61,"column":0},"end":{"row":61,"column":3},"action":"remove","lines":["// "]},{"start":{"row":62,"column":0},"end":{"row":62,"column":3},"action":"remove","lines":["// "]},{"start":{"row":63,"column":0},"end":{"row":63,"column":3},"action":"remove","lines":["// "]},{"start":{"row":65,"column":0},"end":{"row":65,"column":3},"action":"remove","lines":["// "]},{"start":{"row":66,"column":0},"end":{"row":66,"column":3},"action":"remove","lines":["// "]},{"start":{"row":68,"column":0},"end":{"row":68,"column":3},"action":"remove","lines":["// "]},{"start":{"row":69,"column":0},"end":{"row":69,"column":3},"action":"remove","lines":["// "]},{"start":{"row":71,"column":0},"end":{"row":71,"column":3},"action":"remove","lines":["// "]},{"start":{"row":72,"column":0},"end":{"row":72,"column":3},"action":"remove","lines":["// "]},{"start":{"row":73,"column":0},"end":{"row":73,"column":3},"action":"remove","lines":["// "]},{"start":{"row":74,"column":0},"end":{"row":74,"column":3},"action":"remove","lines":["// "]},{"start":{"row":76,"column":0},"end":{"row":76,"column":3},"action":"remove","lines":["// "]},{"start":{"row":77,"column":0},"end":{"row":77,"column":3},"action":"remove","lines":["// "]},{"start":{"row":78,"column":0},"end":{"row":78,"column":3},"action":"remove","lines":["// "]},{"start":{"row":79,"column":0},"end":{"row":79,"column":3},"action":"remove","lines":["// "]},{"start":{"row":80,"column":0},"end":{"row":80,"column":3},"action":"remove","lines":["// "]},{"start":{"row":81,"column":0},"end":{"row":81,"column":3},"action":"remove","lines":["// "]},{"start":{"row":82,"column":0},"end":{"row":82,"column":3},"action":"remove","lines":["// "]},{"start":{"row":84,"column":0},"end":{"row":84,"column":3},"action":"remove","lines":["// "]},{"start":{"row":86,"column":0},"end":{"row":86,"column":3},"action":"remove","lines":["// "]},{"start":{"row":87,"column":0},"end":{"row":87,"column":3},"action":"remove","lines":["// "]}],[{"start":{"row":86,"column":0},"end":{"row":86,"column":3},"action":"insert","lines":["// "],"id":4}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":86,"column":3},"end":{"row":86,"column":3},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1601433647346,"hash":"6142655ee72e3e5b8efba42cdbf903f18369a3b5"}